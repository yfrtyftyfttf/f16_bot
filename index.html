<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F16 Dashboard</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    
    <style>
        body { font-family: sans-serif; background: #0a0b0e; color: white; margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .card { background: #1a1c23; padding: 25px; border-radius: 20px; width: 90%; max-width: 400px; text-align: center; border: 1px solid #333; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .balance-card { background: #005f73; padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 1px solid #00d2ff; }
        input, select { width: 100%; padding: 12px; margin: 10px 0; border-radius: 10px; border: none; background: #0f0c29; color: white; box-sizing: border-box; }
        .btn { background: #00d2ff; color: white; border: none; padding: 12px; width: 100%; border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        #authOverlay { position: fixed; inset: 0; background: #0a0b0e; z-index: 1000; display: flex; justify-content: center; align-items: center; }
    </style>
</head>
<body>

    <div id="authOverlay">
        <div class="card">
            <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
            <input type="email" id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
            <input type="password" id="pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            <button class="btn" onclick="handleAuth()">Ø¯Ø®ÙˆÙ„</button>
            <p id="authStatus" style="font-size: 12px; color: gray; margin-top: 10px;"></p>
        </div>
    </div>

    <div class="card">
        <div class="balance-card">
            <h3 id="uName">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</h3>
            <h1 id="uBalance">$0.00</h1>
        </div>
        
        <select id="srv">
            <option value="3">Ù…ØªØ§Ø¨Ø¹ÙŠÙ† Ø§Ù†Ø³ØªÙ‚Ø±Ø§Ù… ($3/1k)</option>
            <option value="1">Ù„Ø§ÙŠÙƒØ§Øª Ø§Ù†Ø³ØªÙ‚Ø±Ø§Ù… ($1/1k)</option>
        </select>
        <input type="number" id="qty" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">
        
        <button class="btn" id="orderBtn" onclick="sendOrder()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ ğŸš€</button>
        <button onclick="firebase.auth().signOut()" style="background:none; border:none; color:gray; cursor:pointer; margin-top:15px; font-size:12px;">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
    </div>

    <script>
        // 1. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDrLSVoJJsEzlmcIBvNNb9OJzWtJixYhpw",
            authDomain: "army-smm.firebaseapp.com",
            projectId: "army-smm",
            storageBucket: "army-smm.firebasestorage.app",
            messagingSenderId: "27268417960",
            appId: "1:27268417960:web:990e040e77a0c38a11f59d"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // 2. Ù…Ù†Ø·Ù‚ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª ÙˆØ§Ù„Ø¯Ø®ÙˆÙ„
        async function handleAuth() {
            const e = document.getElementById('email').value, p = document.getElementById('pass').value;
            if(!e || !p) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
            try {
                await auth.signInWithEmailAndPassword(e, p).catch(async () => {
                    const r = await auth.createUserWithEmailAndPassword(e, p);
                    await db.collection("users").doc(r.user.uid).set({ name: "Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯", balance: 10.0 }); // Ø±ØµÙŠØ¯ ØªØ¬Ø±ÙŠØ¨ÙŠ 10$
                });
            } catch (err) { alert(err.message); }
        }

        auth.onAuthStateChanged(user => {
            if (user) {
                document.getElementById('authOverlay').style.display = 'none';
                db.collection("users").doc(user.uid).onSnapshot(doc => {
                    if(doc.exists) {
                        document.getElementById('uName').innerText = "Ù…Ø±Ø­Ø¨Ø§Ù‹: " + doc.data().name;
                        document.getElementById('uBalance').innerText = "$" + doc.data().balance.toFixed(2);
                    }
                });
            } else { document.getElementById('authOverlay').style.display = 'flex'; }
        });

        // 3. Ø¯Ø§Ù„Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ (ØªÙ… Ø¯Ù…Ø¬ Ù…Ù†Ø·Ù‚ ÙƒÙˆØ¯ Ø§Ù„ÙØ­Øµ Ø§Ù„Ù†Ø§Ø¬Ø­ Ù‡Ù†Ø§)
        async function sendOrder() {
            const btn = document.getElementById('orderBtn');
            const qty = document.getElementById('qty').value;
            const srvText = document.getElementById('srv').options[document.getElementById('srv').selectedIndex].text;

            if(!qty) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙƒÙ…ÙŠØ©");

            btn.disabled = true;
            btn.innerText = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...";

            try {
                const user = auth.currentUser;
                const userSnap = await db.collection("users").doc(user.uid).get();
                const userName = userSnap.exists ? userSnap.data().name : "Ø¹Ù…ÙŠÙ„";

                const response = await fetch('https://army-bot-3y9o.onrender.com/send_order', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        user_name: userName,
                        user_uid: user.uid,
                        type: "Ø·Ù„Ø¨ Ø±Ø´Ù‚",
                        details: {
                            "Ø§Ù„Ø®Ø¯Ù…Ø©": srvText,
                            "Ø§Ù„ÙƒÙ…ÙŠØ©": qty,
                            "Ø§Ù„ÙˆÙ‚Øª": new Date().toLocaleTimeString()
                        }
                    })
                });

                if (response.ok) {
                    alert("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­!");
                } else {
                    alert("âŒ Ø§Ù„Ø³ÙŠØ±ÙØ± Ù„Ù… ÙŠØ³ØªØ¬Ø¨ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­");
                }
            } catch (err) {
                alert("âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: " + err.message);
            } finally {
                btn.disabled = false;
                btn.innerText = "ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ ğŸš€";
            }
        }
    </script>
</body>
</html>
