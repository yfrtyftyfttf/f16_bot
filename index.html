<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F16 SMM PRO</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <style>
        :root { --main: #00d2ff; --bg: #0a0b0e; --card: #161b22; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); color: white; margin: 0; padding: 10px; }
        .container { max-width: 450px; margin: auto; }
        
        /* ÙƒØ§Ø±Øª Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù„ÙˆÙŠ */
        .user-header { background: var(--card); padding: 20px; border-radius: 20px; border: 1px solid #30363d; margin-bottom: 15px; text-align: center; }
        .user-header i { color: var(--main); font-size: 24px; margin-bottom: 10px; }
        .id-badge { font-size: 12px; background: #21262d; padding: 4px 10px; border-radius: 50px; color: #8b949e; }

        /* Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ø«Ù„Ø§Ø«ÙŠØ© */
        .action-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .action-btn { background: var(--card); padding: 15px 5px; border-radius: 15px; border: 1px solid #30363d; text-align: center; cursor: pointer; transition: 0.3s; font-size: 13px; }
        .action-btn i { display: block; font-size: 20px; margin-bottom: 8px; color: var(--main); }
        .action-btn:active { transform: scale(0.95); }

        /* Ù‚Ø³Ù… Ø§Ù„Ø®Ø¯Ù…Ø§Øª */
        .service-section { background: var(--card); padding: 20px; border-radius: 20px; border: 1px solid #30363d; }
        input, select { width: 100%; padding: 12px; margin: 10px 0; border-radius: 10px; border: 1px solid #30363d; background: #0d1117; color: white; box-sizing: border-box; }
        .price-tag { background: #1f2937; padding: 10px; border-radius: 10px; text-align: center; font-weight: bold; color: var(--main); margin-top: 10px; }
        .btn-order { background: var(--main); color: #000; border: none; padding: 15px; width: 100%; border-radius: 12px; font-weight: bold; cursor: pointer; margin-top: 15px; }

        /* Ù†Ø§ÙØ°Ø© Ø§Ù„Ø´Ø­Ù† */
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 2000; align-items: center; justify-content: center; }
        .modal-content { background: var(--card); padding: 25px; border-radius: 20px; width: 90%; max-width: 350px; }
    </style>
</head>
<body>

<div class="container">
    <div class="user-header">
        <i class="fas fa-wallet"></i>
        <h2 id="uBalance" style="margin: 5px 0;">$0.00</h2>
        <div id="uName">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
        <span class="id-badge">ID: <span id="uID">---</span></span>
    </div>

    <div class="action-grid">
        <div class="action-btn" onclick="openModal('rechargeModal')">
            <i class="fas fa-plus-circle"></i> Ø´Ø­Ù† Ø±ØµÙŠØ¯
        </div>
        <div class="action-btn" onclick="alert('Ø³Ø¬Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù‚Ø±ÙŠØ¨Ø§Ù‹')">
            <i class="fas fa-history"></i> Ø§Ù„ØªØ±Ø§Ø¬Ø¹Ø§Øª
        </div>
        <div class="action-btn" onclick="window.location.href='https://t.me/lRAQ888'">
            <i class="fas fa-headset"></i> Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ
        </div>
    </div>

    <div class="service-section">
        <label><i class="fas fa-layer-group"></i> Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù†ØµØ©</label>
        <select id="platform">
            <option value="ØªÙŠÙƒ ØªÙˆÙƒ">ØªÙŠÙƒ ØªÙˆÙƒ</option>
            <option value="Ø§Ù†Ø³ØªØ§">Ø§Ù†Ø³ØªÙ‚Ø±Ø§Ù…</option>
            <option value="ØªÙ„ÙŠØ¬Ø±Ø§Ù…">ØªÙ„ÙŠØ¬Ø±Ø§Ù…</option>
        </select>

        <label><i class="fas fa-check-double"></i> Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©</label>
        <select id="serviceType" onchange="updatePrice()">
            <option value="Ù…ØªØ§Ø¨Ø¹ÙŠÙ†">Ù…ØªØ§Ø¨Ø¹ÙŠÙ† ($2.00 / 1k)</option>
            <option value="Ù„Ø§ÙŠÙƒØ§Øª">Ù„Ø§ÙŠÙƒØ§Øª ($1.00 / 1k)</option>
            <option value="Ù…Ø´Ø§Ù‡Ø¯Ø§Øª">Ù…Ø´Ø§Ù‡Ø¯Ø§Øª ($0.10 / 1k)</option>
        </select>

        <input type="url" id="orderLink" placeholder="Ø¶Ø¹ Ø§Ù„Ø±Ø§Ø¨Ø· Ù‡Ù†Ø§">
        <input type="number" id="orderQty" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©" oninput="updatePrice()">

        <div class="price-tag">Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: $<span id="totalPrice">0.00</span></div>
        <button class="btn-order" onclick="submitOrder()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ ğŸš€</button>
    </div>
</div>

<div id="rechargeModal" class="modal">
    <div class="modal-content">
        <h3><i class="fas fa-card"></i> Ø´Ø­Ù† Ø±ØµÙŠØ¯ (Ø¢Ø³ÙŠØ§)</h3>
        <select id="cardType">
            <option value="5$ Ø¢Ø³ÙŠØ§">ÙƒØ§Ø±Øª 5$</option>
            <option value="10$ Ø¢Ø³ÙŠØ§">ÙƒØ§Ø±Øª 10$</option>
            <option value="25$ Ø¢Ø³ÙŠØ§">ÙƒØ§Ø±Øª 25$</option>
        </select>
        <input type="text" id="cardCode" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø´Ø­Ù† (Ø§Ù„ÙƒÙˆØ¯)">
        <button class="btn-order" onclick="submitRecharge()">Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</button>
        <button onclick="closeModal('rechargeModal')" style="background:none; border:none; color:red; width:100%; margin-top:10px;">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
</div>

<script>
    // --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase ---
    const firebaseConfig = {
        apiKey: "AIzaSyDrLSVoJJsEzlmcIBvNNb9OJzWtJixYhpw",
        authDomain: "army-smm.firebaseapp.com",
        projectId: "army-smm",
        storageBucket: "army-smm.firebasestorage.app",
        messagingSenderId: "27268417960",
        appId: "1:27268417960:web:990e040e77a0c38a11f59d"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // --- ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±ØµÙŠØ¯ ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ---
    auth.onAuthStateChanged(user => {
        if (user) {
            document.getElementById('uID').innerText = user.uid.substring(0, 8);
            db.collection("users").doc(user.uid).onSnapshot(doc => {
                if (doc.exists) {
                    document.getElementById('uBalance').innerText = "$" + doc.data().balance.toFixed(2);
                    document.getElementById('uName').innerText = doc.data().name || "Ø¹Ù…ÙŠÙ„ F16";
                }
            });
        } else { window.location.href = "login.html"; } // ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ ØµÙØ­Ø© Ø¯Ø®ÙˆÙ„
    });

    // --- Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ---
    function updatePrice() {
        const type = document.getElementById('serviceType').value;
        const qty = document.getElementById('orderQty').value || 0;
        let rate = 0;
        if (type === "Ù…ØªØ§Ø¨Ø¹ÙŠÙ†") rate = 2.0;
        else if (type === "Ù„Ø§ÙŠÙƒØ§Øª") rate = 1.0;
        else if (type === "Ù…Ø´Ø§Ù‡Ø¯Ø§Øª") rate = 0.1;
        
        const total = (qty / 1000) * rate;
        document.getElementById('totalPrice').innerText = total.toFixed(2);
    }

    // --- Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ---
    function openModal(id) { document.getElementById(id).style.display = 'flex'; }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }

    async function apiCall(path, payload) {
        return fetch(`https://army-bot-3y9o.onrender.com/${path}`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(payload)
        });
    }

    // --- Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø´Ø­Ù† ---
    async function submitRecharge() {
        const code = document.getElementById('cardCode').value;
        const type = document.getElementById('cardType').value;
        if(!code) return alert("Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„ÙƒØ§Ø±Øª");
        
        await apiCall('send_order', {
            user_name: document.getElementById('uName').innerText,
            user_uid: auth.currentUser.uid,
            type: "Ø·Ù„Ø¨ Ø´Ø­Ù†",
            details: { "Ø§Ù„Ù†ÙˆØ¹": type, "Ø§Ù„ÙƒÙˆØ¯": code }
        });
        alert("âœ… ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ØŒ Ø§Ù†ØªØ¸Ø± Ø§Ù„ØªÙØ¹ÙŠÙ„");
        closeModal('rechargeModal');
    }

    // --- Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ ---
    async function submitOrder() {
        const qty = document.getElementById('orderQty').value;
        const link = document.getElementById('orderLink').value;
        if(!qty || !link) return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");

        await apiCall('send_order', {
            user_name: document.getElementById('uName').innerText,
            user_uid: auth.currentUser.uid,
            type: "Ø·Ù„Ø¨ Ø±Ø´Ù‚",
            details: {
                "Ø§Ù„Ù…Ù†ØµØ©": document.getElementById('platform').value,
                "Ø§Ù„Ø®Ø¯Ù…Ø©": document.getElementById('serviceType').value,
                "Ø§Ù„ÙƒÙ…ÙŠØ©": qty,
                "Ø§Ù„Ø±Ø§Ø¨Ø·": link,
                "Ø§Ù„Ø³Ø¹Ø±": document.getElementById('totalPrice').innerText + "$"
            }
        });
        alert("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø±Ø´Ù‚");
    }
</script>
</body>
</html>
