<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F16 SMM Panel</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <style>
        :root { --primary: #00d2ff; --bg: #0a0b0e; --card: #1a1c23; }
        body { font-family: sans-serif; background: var(--bg); color: white; margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .card { background: var(--card); padding: 25px; border-radius: 20px; width: 90%; max-width: 400px; text-align: center; border: 1px solid #333; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .balance-card { background: #005f73; padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 1px solid var(--primary); }
        input, select { width: 100%; padding: 12px; margin: 10px 0; border-radius: 10px; border: none; background: #0f0c29; color: white; box-sizing: border-box; outline: none; }
        .btn { background: var(--primary); color: white; border: none; padding: 12px; width: 100%; border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 10px; transition: 0.3s; }
        .btn:disabled { background: #555; cursor: not-allowed; }
        #authOverlay { position: fixed; inset: 0; background: var(--bg); z-index: 1000; display: flex; justify-content: center; align-items: center; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="authOverlay">
        <div class="card">
            <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ / F16</h2>
            <input type="email" id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
            <input type="password" id="pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            <button class="btn" id="loginBtn" onclick="handleAuth()">Ø¯Ø®ÙˆÙ„</button>
        </div>
    </div>

    <div class="card" id="mainDashboard">
        <div class="balance-card">
            <h3 id="uName">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</h3>
            <h1 id="uBalance">$0.00</h1>
        </div>
        
        <select id="srv">
            <option value="Ù…ØªØ§Ø¨Ø¹ÙŠÙ† Ø§Ù†Ø³ØªÙ‚Ø±Ø§Ù…">Ù…ØªØ§Ø¨Ø¹ÙŠÙ† Ø§Ù†Ø³ØªÙ‚Ø±Ø§Ù… ($3)</option>
            <option value="Ù„Ø§ÙŠÙƒØ§Øª Ø§Ù†Ø³ØªÙ‚Ø±Ø§Ù…">Ù„Ø§ÙŠÙƒØ§Øª Ø§Ù†Ø³ØªÙ‚Ø±Ø§Ù… ($1)</option>
        </select>
        <input type="number" id="qty" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">
        
        <button class="btn" id="orderBtn" onclick="sendOrder()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ ğŸš€</button>
        <button onclick="logout()" style="background:none; border:none; color:gray; cursor:pointer; margin-top:15px;">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
    </div>

    <script>
        // 1. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDrLSVoJJsEzlmcIBvNNb9OJzWtJixYhpw",
            authDomain: "army-smm.firebaseapp.com",
            projectId: "army-smm",
            storageBucket: "army-smm.firebasestorage.app",
            messagingSenderId: "27268417960",
            appId: "1:27268417960:web:990e040e77a0c38a11f59d"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // 2. Ù…Ø±Ø§Ù‚Ø¨Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        auth.onAuthStateChanged(user => {
            const authOverlay = document.getElementById('authOverlay');
            if (user) {
                authOverlay.classList.add('hidden');
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­ÙŠØ©
                db.collection("users").doc(user.uid).onSnapshot(doc => {
                    if (doc.exists) {
                        document.getElementById('uName').innerText = "Ù…Ø±Ø­Ø¨Ø§Ù‹: " + (doc.data().name || "Ø¹Ù…ÙŠÙ„");
                        document.getElementById('uBalance').innerText = "$" + (doc.data().balance || 0).toFixed(2);
                    }
                });
            } else {
                authOverlay.classList.remove('hidden');
            }
        });

        // 3. ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„Ø®Ø±ÙˆØ¬
        async function handleAuth() {
            const e = document.getElementById('email').value, p = document.getElementById('pass').value;
            if(!e || !p) return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
            try {
                await auth.signInWithEmailAndPassword(e, p).catch(async () => {
                    const r = await auth.createUserWithEmailAndPassword(e, p);
                    await db.collection("users").doc(r.user.uid).set({ name: "Ø¹Ù…ÙŠÙ„", balance: 0.0 });
                });
            } catch (err) { alert("Ø®Ø·Ø£: " + err.message); }
        }

        function logout() { auth.signOut(); }

        // 4. Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ù„Ù„Ø³ÙŠØ±ÙØ±
        async function sendOrder() {
            const btn = document.getElementById('orderBtn');
            const qty = document.getElementById('qty').value;
            const srv = document.getElementById('srv').value;

            if(!qty || qty <= 0) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ…ÙŠØ© ØµØ­ÙŠØ­Ø©");

            btn.disabled = true;
            btn.innerText = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...";

            try {
                const user = auth.currentUser;
                const response = await fetch('https://army-bot-3y9o.onrender.com/send_order', {
                    method: 'POST',
                    mode: 'cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        user_name: document.getElementById('uName').innerText,
                        user_uid: user.uid,
                        type: "Ø·Ù„Ø¨ Ø±Ø´Ù‚",
                        details: { "Ø§Ù„Ø®Ø¯Ù…Ø©": srv, "Ø§Ù„ÙƒÙ…ÙŠØ©": qty }
                    })
                });

                if (response.ok) {
                    alert("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­!");
                } else {
                    alert("âŒ ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: Ø§Ù„Ø³ÙŠØ±ÙØ± Ù„Ø§ ÙŠØ³ØªØ¬ÙŠØ¨");
                }
            } catch (err) {
                alert("âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±");
            } finally {
                btn.disabled = false;
                btn.innerText = "ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ ğŸš€";
            }
        }
    </script>
</body>
</html>
